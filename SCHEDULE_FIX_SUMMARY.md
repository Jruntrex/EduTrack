# Виправлення: Збереження розкладу в Адміні

## Проблема
На сторінці зміни розкладу (як у кастомному інтерфейсі, так і в Django-адміні) зміни не зберігалися в базі даних.

## Причини
1. **Відсутність ScheduleTemplateAdmin**: Модель `ScheduleTemplate` була зареєстрована в адміні без власного класу `ModelAdmin`, що призводило до проблем з обробкою і валідацією даних
2. **Неповна обробка помилок**: Функція `api_save_schedule_slot` використовувала методи `.get()` без обробки исключень
3. **Відсутність синхронізації**: Поле `teaching_assignment` не оновлювалося автоматично при зміні основних полів
4. **Відсутність унікального constraint**: Модель не мала унікального обмеження для запобігання дублювання слотів

## Виправлення

### 1. **admin.py** - Додано `ScheduleTemplateAdmin` клас
```python
class ScheduleTemplateAdmin(admin.ModelAdmin):
    # - Налаштовано відображення полів в списку
    # - Додано інформативні колони (День, Предмет, Викладач)
    # - Переопалювано методу save_model для автоматичного оновлення teaching_assignment
```

### 2. **views.py** - Поліпшена функція `api_save_schedule_slot`
- Замінено `.get()` на `get_object_or_404()` для кращої обробки помилок
- Додано перевірки на None для teacher і classroom
- Додана обробка JSON ошибок
- Додано вывід traceback для відладки

### 3. **models.py** - Дві головні змін
```python
# 1. Додано метод save() в ScheduleTemplate:
def save(self, *args, **kwargs):
    # Автоматично оновлює teaching_assignment
    if self.teacher and self.subject and self.group:
        self.teaching_assignment, _ = TeachingAssignment.objects.get_or_create(...)
    super().save(*args, **kwargs)

# 2. Додано unique_together в Meta:
unique_together = ('group', 'day_of_week', 'lesson_number')
```

## Миграції
Створена нова міграція `0003_alter_scheduletemplate_unique_together.py` для додання унікального обмеження

## Результат
✅ Збереження розкладу тепер працює в обох місцях:
- Django-адмін (`/admin/main/scheduletemplate/`)
- Кастомний редактор розкладу (`/schedule/editor/`)

## Тестування
1. Перейти на `/schedule/editor/`
2. Вибрати групу
3. Клікнути на слот розкладу
4. Вибрати предмет, викладача, час та аудиторію
5. Натиснути "Зберегти"
6. Перевірити, що дані збереглися и сторінка перезавантажилась

## Примітки
- Поле `teaching_assignment` тепер синхронізується автоматично при збереженні через будь-який метод (API, адмін, ORM)
- Виключена можливість дублювання розкладу для однієї групи в один день та час
- Додана обширна обробка помилок для кращої діагностики проблем
