{% extends 'base.html' %}
{% load static %}

{% block title %}–î–∞—à–±–æ—Ä–¥ –≤–∏–∫–ª–∞–¥–∞—á–∞{% endblock %}
{% block header_title %}–û–≥–ª—è–¥{% endblock %}

{% block extra_head %}
<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    .glass-tile {
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .custom-shadow {
        box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.05);
    }

    .custom-scrollbar::-webkit-scrollbar {
        width: 4px;
    }

    .custom-scrollbar::-webkit-scrollbar-track {
        background: transparent;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
        background: #f1f5f9;
        border-radius: 10px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: #e2e8f0;
    }
</style>
{% endblock %}

{% block content %}
<div class="grid grid-cols-1 md:grid-cols-4 gap-6 pb-10">

    <!-- 1. Header (Greeting) -->
    <div class="col-span-1 md:col-span-4 flex flex-col md:flex-row justify-between items-end mb-2">
        <div>
            <h1 class="text-3xl font-bold text-gray-900 tracking-tight">–ü—Ä–∏–≤—ñ—Ç, {{ request.user.full_name }}! üëã</h1>
            <p class="text-xs font-bold text-gray-400 uppercase tracking-widest mt-1">{% now "d E, l" %}</p>
        </div>
    </div>

    <!-- 2. KPI: –°—å–æ–≥–æ–¥–Ω—ñ –ø–∞—Ä (Blue Gradient Accent) -->
    <div
        class="col-span-1 bg-gradient-to-br from-blue-600 to-indigo-700 text-white rounded-3xl shadow-xl p-8 flex flex-col justify-between min-h-[240px]">
        <div>
            <div class="bg-blue-400/30 w-12 h-12 rounded-2xl flex items-center justify-center mb-6">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
            </div>
            <span class="text-blue-100 text-sm font-medium">–°—å–æ–≥–æ–¥–Ω—ñ –ø–∞—Ä</span>
            <div class="text-7xl font-black mt-2 tracking-tighter">{{ today_lessons|length }}</div>
        </div>
        <div class="text-xs text-blue-200/80 font-medium">
            <span class="bg-white/20 px-2 py-1 rounded-lg">–ó–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–æ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ</span>
        </div>
    </div>

    <!-- 3. KPI: –ù–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è (White Card) -->
    <div class="col-span-1 md:col-span-2 bg-white rounded-3xl custom-shadow p-8 flex flex-col justify-between">
        <div class="flex justify-between items-start">
            <div>
                <h3 class="text-gray-500 font-semibold tracking-wide uppercase text-sm mb-1">–¢–∏–∂–Ω–µ–≤–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</h3>
                <div class="flex items-baseline gap-2">
                    <span class="text-4xl font-black text-gray-800">{{ weekly_load }}</span>
                    <span class="text-xs font-bold text-gray-400 uppercase">–≥–æ–¥.</span>
                </div>
            </div>
            <span
                class="px-3 py-1 bg-blue-50 text-blue-600 rounded-full text-xs font-bold border border-blue-100">–ù–æ—Ä–º–∞:
                18</span>
        </div>

        <div class="mt-8">
            <div class="flex justify-between items-end mb-2">
                <span class="text-xs font-bold text-gray-400 uppercase">–ü—Ä–æ–≥—Ä–µ—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è</span>
                <span class="text-xs font-bold text-blue-600">75%</span>
            </div>
            <div class="w-full bg-gray-100 rounded-full h-3">
                <div class="bg-blue-600 h-3 rounded-full shadow-lg shadow-blue-200" style="width: 75%"></div>
            </div>
        </div>
    </div>

    <!-- 4. KPI: –°—Ç—É–¥–µ–Ω—Ç–∏ –≤ —Ä–∏–∑–∏–∫—É (White Card) -->
    <div class="col-span-1 bg-white rounded-3xl custom-shadow p-8 flex flex-col justify-between">
        <div>
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-gray-500 font-semibold tracking-wide uppercase text-sm">–£ –∑–æ–Ω—ñ —Ä–∏–∑–∏–∫—É</h3>
                <span class="flex h-3 w-3 relative">
                    <span
                        class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                    <span class="relative inline-flex rounded-full h-3 w-3 bg-red-500"></span>
                </span>
            </div>
            <div class="text-5xl font-black text-red-500 tracking-tighter">{{ risk_students|length }}</div>
            <p class="text-xs text-gray-400 mt-2 font-medium">–°—Ç—É–¥–µ–Ω—Ç—ñ–≤ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å —É–≤–∞–≥–∏</p>
        </div>
        <a href="#risk-radar"
            class="mt-4 text-red-500 text-xs font-bold hover:bg-red-50 px-3 py-2 rounded-lg transition-colors flex items-center justify-between group">
            <span>–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Å–ø–∏—Å–æ–∫</span>
            <svg class="w-4 h-4 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor"
                viewBox="0 0 24 24">
                <path d="M9 5l7 7-7 7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
        </a>
    </div>

    <!-- 5. –†–æ–∑–∫–ª–∞–¥ (Timeline) -->
    <div class="col-span-1 md:col-span-3 bg-white rounded-3xl custom-shadow p-8 relative overflow-hidden">
        <div class="flex justify-between items-center mb-8">
            <h3 class="text-gray-500 font-semibold tracking-wide uppercase text-sm">–†–æ–∑–∫–ª–∞–¥ (Timeline)</h3>
            <div class="flex items-center gap-2">
                <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">–ü–æ–¥—ñ—ó —Å—å–æ–≥–æ–¥–Ω—ñ</span>
            </div>
        </div>

        {% if today_lessons %}
        <div class="relative space-y-4">
            {% for lesson in today_lessons %}
            <div
                class="flex flex-col md:flex-row gap-4 p-4 rounded-2xl hover:bg-gray-50 transition-all border border-transparent hover:border-gray-100 group">
                <div
                    class="flex-shrink-0 flex flex-col items-center justify-center w-20 h-20 bg-gray-100 rounded-2xl group-hover:bg-white group-hover:shadow-md transition-all">
                    <span class="text-sm font-black text-gray-900">{{ lesson.start_time|time:"H:i" }}</span>
                    <span class="text-xs font-bold text-gray-400">{{ lesson.end_time|time:"H:i" }}</span>
                </div>

                <div class="flex-grow flex flex-col justify-center">
                    <h4 class="text-lg font-black text-gray-900 mb-1 group-hover:text-blue-600 transition-colors">{{
                        lesson.subject.name }}</h4>
                    <div class="flex items-center gap-3 text-xs font-medium text-gray-500">
                        <span class="flex items-center gap-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path
                                    d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            {{ lesson.group.name }}
                        </span>
                        <span class="flex items-center gap-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path
                                    d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                <path d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" />
                            </svg>
                            –ê—É–¥. {{ lesson.classroom.name|default:"‚Äî" }}
                        </span>
                    </div>
                </div>

                <div class="flex items-center">
                    <a href="{% url 'teacher_live_mode' lesson.id %}"
                        class="w-full md:w-auto px-6 py-3 bg-gray-900 text-white text-sm font-bold rounded-xl hover:bg-blue-600 hover:shadow-lg transition-all flex items-center justify-center gap-2">
                        <span>Live Mode</span>
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path d="M14 5l7 7m0 0l-7 7m7-7H3" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="flex flex-col items-center justify-center py-20 text-center">
            <div class="w-16 h-16 bg-gray-50 rounded-2xl flex items-center justify-center mb-4 text-3xl opacity-50">‚òï
            </div>
            <h3 class="text-lg font-bold text-gray-900">–ù–∞ —Å—å–æ–≥–æ–¥–Ω—ñ –ø–∞—Ä –Ω–µ–º–∞—î</h3>
            <p class="text-gray-400 text-sm">–ß–∞—Å –≤—ñ–¥–ø–æ—á–∏—Ç–∏ –∞–±–æ –ø—ñ–¥–≥–æ—Ç—É–≤–∞—Ç–∏—Å—è –¥–æ –∑–∞–Ω—è—Ç—å</p>
        </div>
        {% endif %}
    </div>

    <!-- 6. –†–∞–¥–∞—Ä —Ä–∏–∑–∏–∫—É (List) -->
    <div id="risk-radar" class="col-span-1 bg-white rounded-3xl custom-shadow p-8">
        <h3 class="text-gray-500 font-semibold tracking-wide uppercase text-sm mb-6">–†–∞–¥–∞—Ä –†–∏–∑–∏–∫—É</h3>
        <div class="space-y-4 max-h-[400px] overflow-y-auto pr-2 custom-scrollbar">
            {% for student in risk_students %}
            <div class="flex items-center gap-3 p-3 rounded-2xl hover:bg-red-50 transition-all cursor-pointer group">
                <div
                    class="flex-shrink-0 w-10 h-10 bg-red-100 text-red-500 rounded-xl flex items-center justify-center font-black text-xs group-hover:bg-red-200 transition-colors">
                    {{ student.name|slice:":1" }}
                </div>
                <div class="min-w-0">
                    <p class="text-sm font-bold text-gray-800 truncate group-hover:text-red-600 transition-colors">{{
                        student.name }}</p>
                    <div class="flex items-center gap-2 mt-0.5">
                        <span class="text-[10px] font-bold text-gray-400 uppercase bg-gray-100 px-1.5 rounded">{{
                            student.group }}</span>
                        <span class="text-[10px] font-bold text-red-400">{{ student.issue }}</span>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="text-center py-10">
                <div class="text-3xl mb-2 opacity-50">‚ú®</div>
                <p class="text-xs text-gray-400 font-medium">–í—Å–µ —á—É–¥–æ–≤–æ!</p>
            </div>
            {% endfor %}
        </div>
        {% if risk_students %}
        <div class="mt-6 pt-6 border-t border-gray-50">
            <button
                class="w-full py-3 text-xs font-black text-gray-400 uppercase tracking-widest hover:text-red-500 hover:bg-red-50 rounded-xl transition-all">
                –ù–∞–≥–∞–¥–∞—Ç–∏ –≤—Å—ñ–º
            </button>
        </div>
        {% endif %}
    </div>

    <!-- 7. Quick Actions (Grid) -->
    <div class="col-span-1 md:col-span-4 grid grid-cols-2 md:grid-cols-4 gap-6 mt-2">
        <a href="{% url 'teacher_journal' %}"
            class="bg-white rounded-3xl custom-shadow p-6 hover:translate-y-[-4px] transition-transform duration-300 group">
            <div
                class="w-12 h-12 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center mb-4 group-hover:bg-blue-600 group-hover:text-white transition-colors">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path
                        d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
            <h3 class="text-lg font-bold text-gray-900 group-hover:text-blue-600 transition-colors">–ñ—É—Ä–Ω–∞–ª</h3>
            <p class="text-xs text-gray-400 mt-1">–í–∏—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –æ—Ü—ñ–Ω–æ–∫</p>
        </a>

        <a href="{% url 'timeline_schedule' %}"
            class="bg-white rounded-3xl custom-shadow p-6 hover:translate-y-[-4px] transition-transform duration-300 group">
            <div
                class="w-12 h-12 bg-indigo-50 text-indigo-600 rounded-2xl flex items-center justify-center mb-4 group-hover:bg-indigo-600 group-hover:text-white transition-colors">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
            </div>
            <h3 class="text-lg font-bold text-gray-900 group-hover:text-indigo-600 transition-colors">–†–æ–∑–∫–ª–∞–¥</h3>
            <p class="text-xs text-gray-400 mt-1">–¢–∞–π–º–ª–∞–π–Ω –ø–æ–¥—ñ–π</p>
        </a>

        <a href="{% url 'manage_evaluation_types' %}"
            class="bg-white rounded-3xl custom-shadow p-6 hover:translate-y-[-4px] transition-transform duration-300 group">
            <div
                class="w-12 h-12 bg-purple-50 text-purple-600 rounded-2xl flex items-center justify-center mb-4 group-hover:bg-purple-600 group-hover:text-white transition-colors">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path
                        d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
            </div>
            <h3 class="text-lg font-bold text-gray-900 group-hover:text-purple-600 transition-colors">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h3>
            <p class="text-xs text-gray-400 mt-1">–¢–∏–ø–∏ –æ—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è</p>
        </a>

        <div class="bg-white rounded-3xl custom-shadow p-6 opacity-60 grayscale cursor-not-allowed">
            <div class="w-12 h-12 bg-gray-50 text-gray-400 rounded-2xl flex items-center justify-center mb-4">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path
                        d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
            <h3 class="text-lg font-bold text-gray-900">–ê–Ω–∞–ª—ñ—Ç–∏–∫–∞</h3>
            <p class="text-xs text-gray-400 mt-1">–°–∫–æ—Ä–æ –±—É–¥–µ</p>
        </div>
    </div>

    <!-- 8. Interactive Random (Student Style) -->
    <div class="col-span-1 md:col-span-4 mt-4">
        <div
            class="bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900 rounded-3xl p-8 flex flex-col md:flex-row items-center justify-between gap-8 relative overflow-hidden shadow-2xl">
            <div class="relative z-10 text-center md:text-left">
                <h3 class="text-2xl font-black text-white tracking-tight mb-1">–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤ üé≤</h3>
                <p class="text-gray-400 text-sm font-medium">–í–∏–ø–∞–¥–∫–æ–≤–∏–π –≤–∏–±—ñ—Ä —Å—Ç—É–¥–µ–Ω—Ç–∞ –¥–ª—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ</p>
                <div id="randomResult" class="mt-4 min-h-[40px] text-xl font-bold text-blue-400 italic font-mono"></div>
            </div>
            <button onclick="pickRandom()"
                class="relative z-10 px-8 py-4 bg-white text-gray-900 font-bold rounded-2xl hover:bg-blue-500 hover:text-white hover:shadow-2xl hover:shadow-blue-500/20 transition-all active:scale-95 text-sm">
                –û–±—Ä–∞—Ç–∏ –≤–∏–ø–∞–¥–∫–æ–≤–æ–≥–æ
            </button>

            <!-- Shapes -->
            <div class="absolute top-0 right-0 w-64 h-64 bg-blue-600 opacity-20 rounded-full -mr-20 -mt-20 blur-3xl">
            </div>
            <div
                class="absolute bottom-0 left-0 w-48 h-48 bg-purple-600 opacity-10 rounded-full -ml-10 -mb-10 blur-3xl">
            </div>
        </div>
    </div>

</div>

<script>
    const genericNames = ["–í–∏–∫–ª–∏–∫–∞–π—Ç–µ –∑–∞ —Å–ø–∏—Å–∫–æ–º!", "–¢–æ–π, —Ö—Ç–æ —Å—Ö–æ–≤–∞–≤—Å—è", "–°—Ç–∞—Ä–æ—Å—Ç–∞ –≥—Ä—É–ø–∏", "–°—Ç—É–¥–µ–Ω—Ç –±—ñ–ª—è –≤—ñ–∫–Ω–∞", "–°—Ç—É–¥–µ–Ω—Ç –∑ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º"];

    function pickRandom() {
        const resultDiv = document.getElementById('randomResult');
        resultDiv.innerText = "–û–±–∏—Ä–∞—î–º–æ...";
        resultDiv.classList.add('animate-pulse');

        setTimeout(() => {
            const randomName = genericNames[Math.floor(Math.random() * genericNames.length)];
            resultDiv.innerText = `> ${randomName}`; // Terminal style prefix
            resultDiv.classList.remove('animate-pulse');
        }, 600);
    }
</script>
{% endblock %}